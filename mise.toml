[tools]
poetry = { version="latest", pyproject="{{ config_root }}/pyproject.toml" }
python = "3.12.11" # must be after poetry so the poetry bin is first in PATH

[env]
POETRY_VIRTUALENVS_IN_PROJECT = "true"
PYTHONPATH = "."

[tasks.comp]
run = """
python3 ocdid_progress_tracker/main.py
"""

[tasks.readme]
run = """
python3 ocdid_progress_tracker/generate_readme.py
"""

[tasks.convert-test]
run = """
poetry run python scripts/one_off/test_convert_small.py
"""

[tasks.convert-test-delete]
run = """
poetry run python scripts/one_off/test_convert_small.py --delete-original
"""

[tasks.convert-all]
run = """
poetry run python scripts/one_off/convert_to_people_schema.py
"""

[tasks.convert-all-delete]
run = """
poetry run python scripts/one_off/convert_to_people_schema.py --delete-original
"""

[tasks.validate-jurisdiction]
run = """
poetry run python scripts/validate_jurisdiction.py $@
"""

[tasks.test-env]
run = """
poetry run python scripts/one_off/test_env.py
"""

[tasks.add-state]
run = """
poetry run python scripts/pull_jurisdiction_data.py $@
"""

#############################################
## GITHUB ACTIONS
#############################################

[tasks.get-juds]
run = """
docker compose -f docker-compose.slim.yml run --rm civicpatch-slim poetry run \
  python src/cli/cli.py \
    get_juds \
    --num-jurisdictions "{{ option(name="num-jurisdictions") }}" \
    --state "{{ option(name="state") }}"
"""
#run = """
#docker compose -f ../civicpatch-tools/civicpatch/docker-compose.development.yml run --rm civicpatch poetry run \
#  python src/cli/cli.py \
#    get_juds \
#    --num-jurisdictions "3" \
#    --state "wa"
#"""

[tasks.pipeline-run-cicd]
run = """
docker compose -f docker-compose.github-actions.yml run --rm civicpatch-cicd poetry run \
  python src/cli/cli.py \
    run_pipeline \
    --jurisdiction-id "{{ option(name="jurisdiction-id") }}" \
    --name "{{ option(name="name") }}" \
    --url "{{ option(name="url") }}"
"""

[tasks.upload-images-to-cdn]
run = """
docker compose -f docker-compose.slim.yml run --rm civicpatch-slim poetry run \
  python src/scripts/upload_images_to_cdn.py {{ option(name="jurisdiction-id") }}
"""

[tasks.send-costs-to-google-sheets]
run = """
docker compose -f docker-compose.slim.yml \
  --log-level ERROR \
  run --rm civicpatch-slim poetry run \
  python src/scripts/send_costs_to_google_sheets.py {{ option(name="jurisdiction-id") }}
"""

[tasks.generate-data-comment]
run = """
docker compose -f docker-compose.slim.yml run --rm civicpatch-slim poetry run \
  python src/scripts/generate_data_comment.py {{ option(name="jurisdiction-id") }}
"""

[tasks.test-generate-review-comment]
run = """
docker compose -f docker-compose.slim.yml run --rm civicpatch-slim poetry run \
  python src/scripts/generate_review_comment.py ocd-jurisdiction/country:us/state:wa/place:seattle
"""

[tasks.generate-review-comment]
# Ex: /app/data/wa/place__spokane.yml
run = """
docker compose -f docker-compose.slim.yml run --rm civicpatch-slim poetry run \
  python src/scripts/generate_review_comment.py {{ option(name="jurisdiction-id") }}
"""
